{% extends "base.html" %}

{% block title %}Analytics - Aarohan{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">
            <svg class="svg-icon-lg inline mr-2 text-blue-400" viewBox="0 0 24 24" fill="currentColor">
                <path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/>
            </svg> Your Wellness Analytics
        </h1>
        <p class="text-lg text-gray-600">Track your mental health journey and progress</p>
    </div>
    
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main Analytics Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Mood Trends -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                        <span class="text-2xl mr-3">üìà</span>
                        Mood Trends
                    </h2>
                    <select id="mood-timeframe" class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 3 months</option>
                    </select>
                </div>
                
                <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center" id="mood-chart">
                    <canvas id="moodCanvas" width="600" height="250"></canvas>
                </div>
                
                <div class="mt-4 grid grid-cols-5 gap-2 text-center">
                    <div class="p-2 bg-red-50 rounded">
                        <div class="text-2xl">üòî</div>
                        <div class="text-xs text-red-600">Very Low</div>
                        <div class="text-sm font-medium" id="mood-very-low">12%</div>
                    </div>
                    <div class="p-2 bg-orange-50 rounded">
                        <div class="text-2xl">üòê</div>
                        <div class="text-xs text-orange-600">Low</div>
                        <div class="text-sm font-medium" id="mood-low">18%</div>
                    </div>
                    <div class="p-2 bg-yellow-50 rounded">
                        <div class="text-2xl">üôÇ</div>
                        <div class="text-xs text-yellow-600">Neutral</div>
                        <div class="text-sm font-medium" id="mood-neutral">25%</div>
                    </div>
                    <div class="p-2 bg-green-50 rounded">
                        <div class="text-2xl">üòä</div>
                        <div class="text-xs text-green-600">Good</div>
                        <div class="text-sm font-medium" id="mood-good">30%</div>
                    </div>
                    <div class="p-2 bg-blue-50 rounded">
                        <div class="text-2xl">üòÑ</div>
                        <div class="text-xs text-blue-600">Excellent</div>
                        <div class="text-sm font-medium" id="mood-excellent">15%</div>
                    </div>
                </div>
            </div>
            
            <!-- Therapy Sessions -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <span class="text-2xl mr-3">üßò</span>
                    Therapy Sessions
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-medium text-gray-900 mb-3">Session Types</h3>
                        <canvas id="therapyTypeChart" width="200" height="200"></canvas>
                    </div>
                    
                    <div>
                        <h3 class="font-medium text-gray-900 mb-3">Weekly Activity</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Breathing Exercises</span>
                                <div class="flex items-center">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full mr-2">
                                        <div class="w-16 h-2 bg-blue-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-medium">8</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Mindfulness</span>
                                <div class="flex items-center">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full mr-2">
                                        <div class="w-12 h-2 bg-green-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-medium">6</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Journaling</span>
                                <div class="flex items-center">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full mr-2">
                                        <div class="w-8 h-2 bg-purple-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-medium">4</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Art Therapy</span>
                                <div class="flex items-center">
                                    <div class="w-24 h-2 bg-gray-200 rounded-full mr-2">
                                        <div class="w-4 h-2 bg-orange-500 rounded-full"></div>
                                    </div>
                                    <span class="text-sm font-medium">2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Emotional Insights -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <span class="text-2xl mr-3">üß†</span>
                    Emotional Insights
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h3 class="font-medium text-blue-900 mb-2">Most Common Emotion</h3>
                            <div class="flex items-center">
                                <span class="text-3xl mr-3">üòä</span>
                                <div>
                                    <p class="font-medium text-blue-800">Optimistic</p>
                                    <p class="text-sm text-blue-600">Detected 67% of the time</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-green-50 rounded-lg">
                            <h3 class="font-medium text-green-900 mb-2">Improvement Area</h3>
                            <div class="flex items-center">
                                <span class="text-3xl mr-3">üå±</span>
                                <div>
                                    <p class="font-medium text-green-800">Stress Management</p>
                                    <p class="text-sm text-green-600">+23% improvement this month</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="p-4 bg-purple-50 rounded-lg">
                            <h3 class="font-medium text-purple-900 mb-2">Peak Wellness Hours</h3>
                            <div class="flex items-center">
                                <span class="text-3xl mr-3">üåÖ</span>
                                <div>
                                    <p class="font-medium text-purple-800">9:00 AM - 11:00 AM</p>
                                    <p class="text-sm text-purple-600">Best emotional state time</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-orange-50 rounded-lg">
                            <h3 class="font-medium text-orange-900 mb-2">Challenge Period</h3>
                            <div class="flex items-center">
                                <span class="text-3xl mr-3">üåô</span>
                                <div>
                                    <p class="font-medium text-orange-800">8:00 PM - 10:00 PM</p>
                                    <p class="text-sm text-orange-600">Focus on evening routine</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Quick Stats -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">This Week</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">üéØ</span>
                            <span class="font-medium text-gray-900">Sessions</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-indigo-600">12</div>
                            <div class="text-xs text-gray-500">Goal: 15</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">‚è±Ô∏è</span>
                            <span class="font-medium text-gray-900">Minutes</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-green-600">184</div>
                            <div class="text-xs text-gray-500">+23% vs last week</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">üî•</span>
                            <span class="font-medium text-gray-900">Streak</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-orange-600">7</div>
                            <div class="text-xs text-gray-500">days</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">üìà</span>
                            <span class="font-medium text-gray-900">Progress</span>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-bold text-blue-600">85%</div>
                            <div class="text-xs text-gray-500">weekly goal</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Achievements -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Achievements</h3>
                
                <div class="space-y-3">
                    <div class="flex items-center p-3 bg-yellow-50 rounded-lg">
                        <span class="text-2xl mr-3">üèÜ</span>
                        <div>
                            <p class="font-medium text-yellow-900">Week Warrior</p>
                            <p class="text-sm text-yellow-600">7-day session streak</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                        <span class="text-2xl mr-3">üéñÔ∏è</span>
                        <div>
                            <p class="font-medium text-blue-900">Mindful Master</p>
                            <p class="text-sm text-blue-600">50 mindfulness sessions</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-3 bg-green-50 rounded-lg">
                        <span class="text-2xl mr-3">‚≠ê</span>
                        <div>
                            <p class="font-medium text-green-900">Mood Booster</p>
                            <p class="text-sm text-green-600">Consistent mood improvement</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Goals -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Your Goals</h3>
                
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Daily Mindfulness</span>
                            <span>4/7 days</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 57%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Weekly Sessions</span>
                            <span>12/15 sessions</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-600 h-2 rounded-full" style="width: 80%"></div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Mood Tracking</span>
                            <span>6/7 days</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 86%"></div>
                        </div>
                    </div>
                </div>
                
                <button onclick="setNewGoal()" 
                        class="w-full mt-4 bg-indigo-600 text-white py-2 px-4 rounded-lg text-sm hover:bg-indigo-700 transition-colors">
                    Set New Goal
                </button>
            </div>
            
            <!-- Export Data -->
            <div class="bg-gray-50 border border-gray-200 rounded-xl p-4">
                <h3 class="text-sm font-medium text-gray-900 mb-3">Export Your Data</h3>
                <div class="space-y-2">
                    <button onclick="exportData('pdf')" 
                            class="w-full text-left text-sm text-gray-600 hover:text-gray-900 py-1">
                        üìÑ Download PDF Report
                    </button>
                    <button onclick="exportData('csv')" 
                            class="w-full text-left text-sm text-gray-600 hover:text-gray-900 py-1">
                        <svg class="svg-icon inline mr-1" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/>
                        </svg> Export CSV Data
                    </button>
                    <button onclick="exportData('share')" 
                            class="w-full text-left text-sm text-gray-600 hover:text-gray-900 py-1">
                        üì§ Share with Professional
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Simple chart drawing functions (in a real app, you'd use Chart.js or similar)

// Draw mood trend chart
function drawMoodChart() {
    const canvas = document.getElementById('moodCanvas');
    const ctx = canvas.getContext('2d');
    
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Sample mood data (1-5 scale)
    const moodData = [3.2, 3.8, 2.9, 4.1, 3.5, 4.3, 3.9, 4.2, 3.7, 4.0, 4.4, 3.8, 4.1, 3.6];
    const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    
    const chartWidth = canvas.width - 80;
    const chartHeight = canvas.height - 60;
    const startX = 40;
    const startY = 30;
    
    // Draw grid lines
    ctx.strokeStyle = '#e5e7eb';
    ctx.lineWidth = 1;
    
    // Horizontal grid lines
    for (let i = 0; i <= 5; i++) {
        const y = startY + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(startX, y);
        ctx.lineTo(startX + chartWidth, y);
        ctx.stroke();
    }
    
    // Draw mood line
    ctx.strokeStyle = '#4f46e5';
    ctx.lineWidth = 3;
    ctx.beginPath();
    
    const pointWidth = chartWidth / (moodData.length - 1);
    
    for (let i = 0; i < moodData.length; i++) {
        const x = startX + pointWidth * i;
        const y = startY + chartHeight - (moodData[i] / 5) * chartHeight;
        
        if (i === 0) {
            ctx.moveTo(x, y);
        } else {
            ctx.lineTo(x, y);
        }
        
        // Draw point
        ctx.fillStyle = '#4f46e5';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fill();
    }
    
    ctx.stroke();
    
    // Draw labels
    ctx.fillStyle = '#6b7280';
    ctx.font = '12px sans-serif';
    ctx.textAlign = 'center';
    
    for (let i = 0; i < 7; i++) {
        const x = startX + (chartWidth / 6) * i;
        ctx.fillText(labels[i], x, canvas.height - 10);
    }
    
    // Y-axis labels
    ctx.textAlign = 'right';
    for (let i = 0; i <= 5; i++) {
        const y = startY + (chartHeight / 5) * (5 - i) + 5;
        ctx.fillText(i.toString(), startX - 10, y);
    }
}

// Draw therapy type pie chart
function drawTherapyTypeChart() {
    const canvas = document.getElementById('therapyTypeChart');
    const ctx = canvas.getContext('2d');
    
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 80;
    
    const data = [
        { label: 'Breathing', value: 40, color: '#3b82f6' },
        { label: 'Mindfulness', value: 30, color: '#10b981' },
        { label: 'Journaling', value: 20, color: '#8b5cf6' },
        { label: 'Art Therapy', value: 10, color: '#f59e0b' }
    ];
    
    let currentAngle = -Math.PI / 2;
    
    data.forEach(item => {
        const sliceAngle = (item.value / 100) * 2 * Math.PI;
        
        ctx.fillStyle = item.color;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
        ctx.closePath();
        ctx.fill();
        
        currentAngle += sliceAngle;
    });
    
    // Add legend
    const legendY = canvas.height + 20;
    data.forEach((item, index) => {
        ctx.fillStyle = item.color;
        ctx.fillRect(10, legendY + index * 20, 15, 15);
        
        ctx.fillStyle = '#374151';
        ctx.font = '12px sans-serif';
        ctx.fillText(`${item.label} (${item.value}%)`, 30, legendY + index * 20 + 12);
    });
}

// Export functionality
function exportData(type) {
    switch(type) {
        case 'pdf':
            alert('PDF report will be generated with your wellness analytics, mood trends, and session history.');
            break;
        case 'csv':
            alert('CSV file will contain your raw wellness data for external analysis.');
            break;
        case 'share':
            alert('Secure sharing link will be generated for your mental health professional.');
            break;
    }
}

// Set new goal
function setNewGoal() {
    const goal = prompt('What wellness goal would you like to set?');
    if (goal) {
        alert(`Great! Your new goal "${goal}" has been added to your wellness plan.`);
    }
}

// Update timeframe
document.getElementById('mood-timeframe').addEventListener('change', function() {
    drawMoodChart(); // Redraw with new timeframe data
});

// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
    drawMoodChart();
    drawTherapyTypeChart();
});
</script>
{% endblock %}
