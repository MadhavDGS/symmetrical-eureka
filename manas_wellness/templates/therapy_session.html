{% extends "base.html" %}

{% block title %}Therapy Session - Aarohan{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"> <!-- Page Header --> <div class="text-center mb-8"> <h1 class="text-3xl font-bold text-white mb-4"> <svg class="svg-icon-lg inline mr-3" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/> </svg> Personalized Therapy Session </h1> <p class="text-lg text-gray-300">AI-generated therapy exercises tailored to your emotional state</p> </div> <div class="grid lg:grid-cols-3 gap-8"> <!-- Main Therapy Content --> <div class="lg:col-span-2 space-y-6"> <!-- Current Emotion State --> <div class="bg-dark-700 rounded-xl shadow-lg p-6 glass-effect border border-dark-600"> <h2 class="text-xl font-semibold text-white mb-4">Your Current State</h2> <div id="emotion-display" class="text-center p-6 bg-dark-800 rounded-lg border border-dark-600"> {% if initial_emotion and source == 'analysis' %} <div class="text-center"> <span class="text-4xl mb-2 block">😊</span> <h3 id="current-emotion" class="text-2xl font-bold text-white mb-2 capitalize">{{ initial_emotion }}</h3> <p class="text-gray-400 mb-4">Based on your recent emotion analysis</p> <button onclick="generateTherapyFromEmotion('{{ initial_emotion }}')" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"> Generate Therapy Session </button> </div> {% else %} <p class="text-gray-400 mb-4">Let's understand your current emotional state to provide personalized therapy</p> <div class="space-y-3"> <div class="text-sm text-gray-500 mb-3">Choose how you'd like to share your emotions:</div> <!-- Quick emotion selection --> <div class="grid grid-cols-3 gap-2 mb-4"> <button onclick="selectQuickEmotion('happy')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😊</span> <span class="text-sm text-gray-300">Happy</span> </button> <button onclick="selectQuickEmotion('sad')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😢</span> <span class="text-sm text-gray-300">Sad</span> </button> <button onclick="selectQuickEmotion('anxious')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😰</span> <span class="text-sm text-gray-300">Anxious</span> </button> <button onclick="selectQuickEmotion('angry')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😠</span> <span class="text-sm text-gray-300">Angry</span> </button> <button onclick="selectQuickEmotion('stressed')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😫</span> <span class="text-sm text-gray-300">Stressed</span> </button> <button onclick="selectQuickEmotion('neutral')" class="quick-emotion-btn p-3 bg-dark-800 border border-dark-600 rounded-lg hover:bg-dark-600 transition-colors"> <span class="text-2xl block">😐</span> <span class="text-sm text-gray-300">Neutral</span> </button> </div> <div class="text-center"> <div class="text-xs text-gray-500 mb-3">or</div> <button onclick="startDetailedEmotionAnalysis()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors"> Detailed Emotion Analysis </button> </div> </div> {% endif %} </div> </div> <!-- Therapy Content Area --> <div id="therapy-content" class="bg-dark-700 rounded-xl shadow-lg p-6 glass-effect border border-dark-600 hidden"> <div class="flex items-center justify-between mb-4"> <h2 class="text-xl font-semibold text-white">Your Therapy Session</h2> <div class="flex space-x-2"> <button onclick="regenerateTherapy()" class="text-sm bg-dark-800 text-gray-300 px-3 py-1 rounded-md hover:bg-dark-600 border border-dark-600 transition-colors"> <svg class="svg-icon-sm inline mr-1" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C13.1 2 14 2.9 14 4 14 5.1 13.1 6 12 6 10.9 6 10 5.1 10 4 10 2.9 10.9 2 12 2M21 9V7L19 5.5 17 7H14V9H17L19 7.5 21 9M7 18C7 16.9 7.9 16 9 16S11 16.9 11 18 10.1 20 9 20 7 19.1 7 18M14 20.6L15.5 22L21 16.5L19.5 15L14 20.6M11.5 22C8.5 22 6 19.5 6 16.5S8.5 11 11.5 11 17 13.5 17 16.5 14.5 22 11.5 22M12 21C14.9 21 16 18.1 16 16.5S14.9 12 12 12 8 14.1 8 16.5 9.1 21 12 21Z"/> </svg> Regenerate </button> <button onclick="saveSession()" class="text-sm bg-green-800 text-green-200 px-3 py-1 rounded-md hover:bg-green-700 border border-green-600 transition-colors"> <svg class="svg-icon-sm inline mr-1" viewBox="0 0 24 24" fill="currentColor"> <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/> </svg> Save Session </button> </div> </div> <div id="therapy-display" class="space-y-6"> <!-- Therapy content will be loaded here --> </div> <!-- Session Feedback --> <div class="mt-8 p-4 bg-blue-900 bg-opacity-30 rounded-lg border border-blue-600"> <h3 class="text-lg font-medium text-blue-200 mb-3">How was this session?</h3> <div class="flex space-x-2 mb-3"> <button onclick="rateSession(1)" class="p-2 rounded hover:bg-blue-800 transition-colors"> <svg class="svg-icon text-red-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-3.5 6L10 6.5 12 8.5 14 6.5 15.5 8 13.5 10 15.5 12 14 13.5 12 11.5 10 13.5 8.5 12 10.5 10 8.5 8z"/> </svg> </button> <button onclick="rateSession(2)" class="p-2 rounded hover:bg-blue-800 transition-colors"> <svg class="svg-icon text-orange-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-5 9h10v2H7v-2z"/> </svg> </button> <button onclick="rateSession(3)" class="p-2 rounded hover:bg-blue-800 transition-colors"> <svg class="svg-icon text-yellow-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15.5h2V16h-2v1.5zm0-3h2v-6h-2v6z"/> </svg> </button> <button onclick="rateSession(4)" class="p-2 rounded hover:bg-blue-800 transition-colors"> <svg class="svg-icon text-green-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/> </svg> </button> <button onclick="rateSession(5)" class="p-2 rounded hover:bg-blue-800 transition-colors"> <svg class="svg-icon text-green-500" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/> </svg> </button> </div> <textarea id="session-feedback" rows="3" class="w-full px-3 py-2 bg-dark-800 border border-dark-600 text-white placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Share your thoughts about this session (optional)..."></textarea> </div> </div> </div> <!-- Sidebar --> <div class="space-y-6"> <!-- Quick Actions --> <div class="bg-dark-700 rounded-xl shadow-lg p-6 glass-effect border border-dark-600"> <h3 class="text-lg font-semibold text-white mb-4">Quick Exercises</h3> <div class="space-y-3"> <button onclick="quickBreathing()" class="w-full text-left p-3 bg-blue-800 bg-opacity-30 hover:bg-blue-700 hover:bg-opacity-40 rounded-lg transition-colors border border-blue-600"> <div class="flex items-center"> <svg class="svg-icon-lg mr-3 text-blue-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6z"/> </svg> <div> <p class="font-medium text-blue-200">Breathing Exercise</p> <p class="text-sm text-blue-300">5-minute calm</p> </div> </div> </button> <button onclick="quickMindfulness()" class="w-full text-left p-3 bg-green-800 bg-opacity-30 hover:bg-green-700 hover:bg-opacity-40 rounded-lg transition-colors border border-green-600"> <div class="flex items-center"> <svg class="svg-icon-lg mr-3 text-green-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/> </svg> <div> <p class="font-medium text-green-200">Mindfulness</p> <p class="text-sm text-green-300">Present moment</p> </div> </div> </button> <button onclick="quickGratitude()" class="w-full text-left p-3 bg-yellow-800 bg-opacity-30 hover:bg-yellow-700 hover:bg-opacity-40 rounded-lg transition-colors border border-yellow-600"> <div class="flex items-center"> <svg class="svg-icon-lg mr-3 text-yellow-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/> </svg> <div> <p class="font-medium text-yellow-200">Gratitude Journal</p> <p class="text-sm text-yellow-300">Count blessings</p> </div> </div> </button> <button onclick="quickArt()" class="w-full text-left p-3 bg-purple-800 bg-opacity-30 hover:bg-purple-700 hover:bg-opacity-40 rounded-lg transition-colors border border-purple-600"> <div class="flex items-center"> <svg class="svg-icon-lg mr-3 text-purple-400" viewBox="0 0 24 24" fill="currentColor"> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-1.48.41-2.86 1.12-4.06l10.94 10.94C14.86 19.59 13.48 20 12 20z"/> </svg> <div> <p class="font-medium text-purple-200">Art Therapy</p> <p class="text-sm text-purple-300">Creative expression</p> </div> </div> </button> </div> </div> <!-- Progress Tracking --> <div class="bg-dark-700 rounded-xl shadow-lg p-6 glass-effect border border-dark-600"> <h3 class="text-lg font-semibold text-white mb-4">Your Progress</h3> <div class="space-y-4"> <div> <div class="flex justify-between text-sm text-gray-300 mb-1"> <span>Sessions This Week</span> <span>3/5</span> </div> <div class="w-full bg-dark-800 rounded-full h-2"> <div class="bg-indigo-600 h-2 rounded-full" style="width: 60%"></div> </div> </div> <div> <div class="flex justify-between text-sm text-gray-300 mb-1"> <span>Mood Improvement</span> <span>+15%</span> </div> <div class="w-full bg-dark-800 rounded-full h-2"> <div class="bg-green-600 h-2 rounded-full" style="width: 75%"></div> </div> </div> <div> <div class="flex justify-between text-sm text-gray-300 mb-1"> <span>Stress Management</span> <span>Good</span> </div> <div class="w-full bg-dark-800 rounded-full h-2"> <div class="bg-blue-600 h-2 rounded-full" style="width: 80%"></div> </div> </div> </div> </div> <!-- Crisis Support --> <div class="bg-red-50 border border-red-200 rounded-xl p-4"> <h3 class="text-sm font-medium text-red-800 mb-2">Need Immediate Help?</h3> <div class="text-xs text-red-600 space-y-1"> <p>AASRA: <a href="tel:+912227546669" class="underline">91-22-27546669</a></p> <p>Sneha: <a href="tel:+914424640050" class="underline">044-24640050</a></p> <p>Emergency: <a href="tel:112" class="underline font-bold">112</a></p> </div> <button onclick="showCrisisSupport()" class="mt-2 w-full bg-red-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-red-700 transition-colors"> Get Crisis Support </button> </div> </div> </div>
</div>

<!-- Breathing Exercise Modal -->
<div id="breathing-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"> <div class="bg-dark-700 border border-dark-600 rounded-xl p-8 max-w-md w-full mx-4"> <div class="text-center"> <h3 class="text-xl font-semibold text-white mb-4">Breathing Exercise</h3> <div id="breathing-circle" class="w-32 h-32 mx-auto mb-6 rounded-full bg-blue-800 bg-opacity-30 border border-blue-600 flex items-center justify-center"> <div class="w-24 h-24 rounded-full bg-blue-600 transition-all duration-4000" id="breathing-inner"></div> </div> <p id="breathing-instruction" class="text-lg text-gray-300 mb-4">Get ready...</p> <div class="flex space-x-4"> <button onclick="closeBreathingModal()" class="flex-1 bg-dark-800 text-gray-300 py-2 px-4 rounded-lg hover:bg-dark-600 border border-dark-600 transition-colors"> Close </button> <button onclick="startBreathing()" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors"> Start </button> </div> </div> </div>
</div>

<script>
let currentSessionId = null;
let currentEmotion = null;

// Quick emotion selection for immediate therapy
function selectQuickEmotion(emotion) { console.log('Quick emotion selected:', emotion); // Update display const emotionDisplay = document.getElementById('emotion-display'); const emotionEmojis = { 'happy': '😊', 'sad': '😢', 'anxious': '😰', 'angry': '😠', 'stressed': '😫', 'neutral': '😐' }; emotionDisplay.innerHTML = ` <div class="text-center"> <span class="text-4xl mb-2 block">${emotionEmojis[emotion] || '😐'}</span> <h3 class="text-2xl font-bold text-white mb-2 capitalize">${emotion}</h3> <p class="text-gray-400 mb-4">Quick emotion selection</p> <button onclick="generateTherapyFromEmotion('${emotion}')" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors"> Generate Therapy Session </button> <button onclick="resetEmotionSelection()" class="ml-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"> Change </button> </div> `;
}

// Reset emotion selection
function resetEmotionSelection() { location.reload(); // Simple reset - reload the page
}

// Detailed emotion analysis (redirects to analysis page)
function startDetailedEmotionAnalysis() { window.location.href = '/emotion-analysis?return=therapy';
}

// Legacy function name for compatibility
async function startEmotionAnalysis() { startDetailedEmotionAnalysis();
}

// Generate therapy from known emotion (avoiding circular navigation)
async function generateTherapyFromEmotion(emotion) { try { currentEmotion = emotion; // Create emotion data object const emotionData = { primary_emotion: emotion, confidence: 0.8, // Assume good confidence from analysis timestamp: new Date().toISOString(), source: 'previous_analysis' }; // Show loading const button = event.target; button.textContent = 'Generating...'; button.disabled = true; const response = await fetch('/api/therapy/generate', { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ emotion_state: emotionData, session_id: currentSessionId || generateSessionId() }) }); const result = await response.json(); if (result.success) { displayTherapyContent(result.therapy_content); currentSessionId = result.session_id; document.getElementById('therapy-content').classList.remove('hidden'); // Update emotion display to show active session updateEmotionDisplay(emotion); } else { alert('Unable to generate therapy session. Please try again.'); } // Restore button button.textContent = 'Generate Therapy Session'; button.disabled = false; } catch (error) { console.error('Therapy generation error:', error); alert('Error generating therapy session. Please try again.'); // Restore button const button = event.target; button.textContent = 'Generate Therapy Session'; button.disabled = false; }
}

function generateSessionId() { return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

function updateEmotionDisplay(emotion) { const emotionDisplay = document.getElementById('emotion-display'); const emotionEmojis = { 'happy': '😊', 'sad': '😢', 'angry': '😠', 'anxious': '😰', 'stressed': '😤', 'calm': '😌', 'excited': '🤩', 'neutral': '😐' }; emotionDisplay.innerHTML = ` <div class="text-center"> <span class="text-4xl mb-2 block">${emotionEmojis[emotion] || '😐'}</span> <h3 class="text-2xl font-bold text-white mb-2 capitalize">${emotion}</h3> <p class="text-green-400">Therapy session active</p> </div> `;
}

// Generate therapy based on emotion
async function generateTherapy(emotionData) { try { const response = await fetch('/api/therapy/generate', { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ emotion_state: emotionData, session_id: currentSessionId }) }); const result = await response.json(); if (result.success) { displayTherapyContent(result.therapy_content); currentSessionId = result.session_id; document.getElementById('therapy-content').classList.remove('hidden'); } } catch (error) { console.error('Therapy generation error:', error); }
}

// Display therapy content
function displayTherapyContent(therapy) { const display = document.getElementById('therapy-display'); let content = ''; if (therapy.type === 'breathing') { content = ` <div class="bg-blue-50 p-6 rounded-lg"> <h3 class="text-lg font-semibold text-blue-900 mb-3">Breathing Exercise</h3> <p class="text-blue-800 mb-4">${therapy.description}</p> <button onclick="startInteractiveBreathing()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors"> Start Breathing Exercise </button> </div> `; } else if (therapy.type === 'mindfulness') { content = ` <div class="bg-green-50 p-6 rounded-lg"> <h3 class="text-lg font-semibold text-green-900 mb-3">Mindfulness Practice</h3> <p class="text-green-800 mb-4">${therapy.description}</p> <div class="space-y-2"> ${therapy.steps.map((step, index) => ` <div class="flex items-start"> <span class="bg-green-200 text-green-800 rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium mr-3 mt-1">${index + 1}</span> <p class="text-green-800">${step}</p> </div> `).join('')} </div> </div> `; } else if (therapy.type === 'journaling') { content = ` <div class="bg-yellow-50 p-6 rounded-lg"> <h3 class="text-lg font-semibold text-yellow-900 mb-3">Journaling Prompt</h3> <p class="text-yellow-800 mb-4">${therapy.prompt}</p> <textarea class="w-full h-32 p-3 border border-yellow-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Write your thoughts here..."></textarea> <button onclick="saveJournalEntry()" class="mt-3 bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700 transition-colors"> Save Entry </button> </div> `; } display.innerHTML = content;
}

// Quick exercises
function quickBreathing() { document.getElementById('breathing-modal').classList.remove('hidden');
}

function quickMindfulness() { const therapyContent = { type: 'mindfulness', description: 'Take a moment to center yourself with this quick mindfulness exercise.', steps: [ 'Sit comfortably and close your eyes', 'Take three deep breaths', 'Notice five things you can hear', 'Notice four things you can feel', 'Notice three things you can smell', 'Take another deep breath and open your eyes' ] }; displayTherapyContent(therapyContent); document.getElementById('therapy-content').classList.remove('hidden');
}

function quickGratitude() { const therapyContent = { type: 'journaling', prompt: 'Write down three things you are grateful for today. They can be big or small - what matters is acknowledging the positive aspects of your life.' }; displayTherapyContent(therapyContent); document.getElementById('therapy-content').classList.remove('hidden');
}

function quickArt() { const therapyContent = { type: 'art', description: 'Express your current emotions through colors and shapes. There are no rules - just let your feelings guide your creativity.', instructions: [ 'Find some paper and coloring materials', 'Close your eyes and think about how you feel right now', 'Choose colors that represent your emotions', 'Draw or color without thinking too much', 'Spend at least 10 minutes creating' ] }; displayTherapyContent(therapyContent); document.getElementById('therapy-content').classList.remove('hidden');
}

// Breathing exercise
function closeBreathingModal() { document.getElementById('breathing-modal').classList.add('hidden');
}

function startBreathing() { const instruction = document.getElementById('breathing-instruction'); const innerCircle = document.getElementById('breathing-inner'); let phase = 0; // 0: inhale, 1: hold, 2: exhale, 3: hold let cycles = 0; const maxCycles = 5; function breatheCycle() { if (cycles >= maxCycles) { instruction.textContent = 'Great job! You completed the breathing exercise.'; return; } switch(phase) { case 0: // Inhale instruction.textContent = 'Breathe in slowly...'; innerCircle.style.transform = 'scale(1.5)'; innerCircle.style.transition = 'transform 4s ease-in-out'; setTimeout(() => { phase = 1; breatheCycle(); }, 4000); break; case 1: // Hold instruction.textContent = 'Hold your breath...'; setTimeout(() => { phase = 2; breatheCycle(); }, 2000); break; case 2: // Exhale instruction.textContent = 'Breathe out slowly...'; innerCircle.style.transform = 'scale(1)'; setTimeout(() => { phase = 3; breatheCycle(); }, 4000); break; case 3: // Hold instruction.textContent = 'Hold...'; setTimeout(() => { phase = 0; cycles++; instruction.textContent = `Cycle ${cycles + 1} of ${maxCycles}`; setTimeout(breatheCycle, 1000); }, 2000); break; } } breatheCycle();
}

// Session management
async function rateSession(rating) { if (!currentSessionId) return; const feedback = document.getElementById('session-feedback').value; try { await fetch('/api/feedback/submit', { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ session_id: currentSessionId, type: 'therapy_session', rating: rating, comments: feedback }) }); alert('Thank you for your feedback!'); } catch (error) { console.error('Feedback submission error:', error); }
}

async function saveSession() { if (!currentSessionId) { alert('No active session to save'); return; } alert('Session saved successfully!');
}

function regenerateTherapy() { if (currentEmotion) { generateTherapy(currentEmotion); } else { alert('Please complete emotion analysis first'); }
}

function showCrisisSupport() { window.location.href = '/crisis-support';
}

// Check if returning from emotion analysis
const urlParams = new URLSearchParams(window.location.search);
const emotionData = urlParams.get('emotion');
if (emotionData) { try { currentEmotion = JSON.parse(decodeURIComponent(emotionData)); generateTherapy(currentEmotion); } catch (error) { console.error('Error parsing emotion data:', error); }
}
</script>
{% endblock %}
