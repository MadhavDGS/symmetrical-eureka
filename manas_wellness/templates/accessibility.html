{% extends "base.html" %}

{% block title %}Accessibility Features - Aarohan{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">‚ôø Accessibility Features</h1>
        <p class="text-lg text-gray-600">Inclusive mental wellness support for everyone</p>
    </div>
    
    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Main Accessibility Controls -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Eye Tracking Navigation -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                        <span class="text-2xl mr-3">üëÅÔ∏è</span>
                        Eye Tracking Navigation
                    </h2>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600">Status:</span>
                        <span id="eye-tracking-status" class="px-2 py-1 bg-gray-200 text-gray-700 rounded-full text-xs">Inactive</span>
                    </div>
                </div>
                
                <p class="text-gray-600 mb-4">Control Aarohan using only your eyes. Perfect for users with motor impairments.</p>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                        <div>
                            <h3 class="font-medium text-blue-900">Enable Eye Tracking</h3>
                            <p class="text-sm text-blue-600">Camera access required for eye detection</p>
                        </div>
                        <button onclick="toggleEyeTracking()" 
                                id="eye-tracking-toggle"
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Start
                        </button>
                    </div>
                    
                    <div id="eye-tracking-controls" class="hidden space-y-3">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-gray-50 rounded-lg text-center">
                                <h4 class="font-medium text-gray-900">Sensitivity</h4>
                                <input type="range" id="eye-sensitivity" min="1" max="10" value="5" 
                                       class="w-full mt-2">
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg text-center">
                                <h4 class="font-medium text-gray-900">Dwell Time</h4>
                                <input type="range" id="dwell-time" min="500" max="3000" value="1500" 
                                       class="w-full mt-2">
                                <span class="text-xs text-gray-600" id="dwell-time-display">1.5s</span>
                            </div>
                        </div>
                        
                        <!-- Eye tracking visualization -->
                        <div class="relative">
                            <video id="eye-tracking-video" autoplay muted class="w-full h-48 bg-gray-200 rounded-lg object-cover"></video>
                            <div id="eye-tracking-overlay" class="absolute inset-0 pointer-events-none">
                                <div id="gaze-cursor" class="absolute w-4 h-4 bg-red-500 rounded-full opacity-75 transform -translate-x-2 -translate-y-2 hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Voice Control -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <span class="text-2xl mr-3">üé§</span>
                    Voice Control (SARA Integration)
                </h2>
                
                <p class="text-gray-600 mb-4">Use voice commands to navigate and interact with Aarohan.</p>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                        <div>
                            <h3 class="font-medium text-green-900">Voice Assistant</h3>
                            <p class="text-sm text-green-600">Say "Hey Aarohan" to activate</p>
                        </div>
                        <button onclick="toggleVoiceControl()" 
                                id="voice-control-toggle"
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            Enable
                        </button>
                    </div>
                    
                    <div id="voice-control-panel" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <h4 class="font-medium text-gray-900 mb-2">Common Commands</h4>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>"Start emotion analysis"</li>
                                    <li>"Begin therapy session"</li>
                                    <li>"Show breathing exercise"</li>
                                    <li>"Go to dashboard"</li>
                                    <li>"Emergency help"</li>
                                </ul>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <h4 class="font-medium text-gray-900 mb-2">Language Support</h4>
                                <select id="voice-language" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="en-US">English</option>
                                    <option value="hi-IN">Hindi</option>
                                    <option value="te-IN">Telugu</option>
                                    <option value="gu-IN">Gujarati</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="text-center p-4 bg-gray-100 rounded-lg">
                            <div id="voice-status" class="text-gray-600 mb-2">Voice recognition ready</div>
                            <div id="voice-command-display" class="text-lg font-medium text-gray-900 min-h-6"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sign Language Support -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <span class="text-2xl mr-3">ü§ü</span>
                    Sign Language Support
                </h2>
                
                <p class="text-gray-600 mb-4">Communicate with Aarohan using Indian Sign Language (ISL) and American Sign Language (ASL).</p>
                
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-purple-50 rounded-lg">
                        <div>
                            <h3 class="font-medium text-purple-900">Sign Language Recognition</h3>
                            <p class="text-sm text-purple-600">Camera-based gesture recognition</p>
                        </div>
                        <button onclick="toggleSignLanguage()" 
                                id="sign-language-toggle"
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            Start
                        </button>
                    </div>
                    
                    <div id="sign-language-controls" class="hidden">
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sign Language</label>
                                <select id="sign-language-type" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="isl">Indian Sign Language (ISL)</option>
                                    <option value="asl">American Sign Language (ASL)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Detection Mode</label>
                                <select id="sign-detection-mode" class="w-full p-2 border border-gray-300 rounded">
                                    <option value="continuous">Continuous</option>
                                    <option value="on-demand">On Demand</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="relative">
                            <video id="sign-language-video" autoplay muted class="w-full h-48 bg-gray-200 rounded-lg object-cover"></video>
                            <div id="sign-language-overlay" class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 text-white text-center hidden">
                                <div>
                                    <div class="text-2xl mb-2" id="detected-sign">ü§ü</div>
                                    <div id="sign-translation" class="text-lg font-medium">Ready to detect signs</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Accessibility Settings Sidebar -->
        <div class="space-y-6">
            <!-- Quick Settings -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Settings</h3>
                
                <div class="space-y-4">
                    <!-- High Contrast Mode -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">High Contrast</h4>
                            <p class="text-sm text-gray-600">Better visibility</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="high-contrast" class="sr-only peer" onchange="toggleHighContrast()">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <!-- Large Text -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">Large Text</h4>
                            <p class="text-sm text-gray-600">Increase font size</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="large-text" class="sr-only peer" onchange="toggleLargeText()">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <!-- Reduced Motion -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">Reduce Motion</h4>
                            <p class="text-sm text-gray-600">Minimize animations</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="reduced-motion" class="sr-only peer" onchange="toggleReducedMotion()">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <!-- Screen Reader -->
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-medium text-gray-900">Screen Reader</h4>
                            <p class="text-sm text-gray-600">Enhanced ARIA labels</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="screen-reader" class="sr-only peer" onchange="toggleScreenReader()">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Accessibility Help -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <h3 class="text-lg font-medium text-blue-900 mb-2">Need Help?</h3>
                <p class="text-blue-700 text-sm mb-3">
                    Our accessibility features are designed to make Aarohan usable for everyone.
                </p>
                <button onclick="showAccessibilityGuide()" 
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                    View Accessibility Guide
                </button>
            </div>
            
            <!-- Keyboard Shortcuts -->
            <div class="bg-white rounded-xl shadow-lg p-6 glass-effect">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Keyboard Shortcuts</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Skip to main content</span>
                        <code class="bg-gray-100 px-2 py-1 rounded">Tab</code>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Emergency help</span>
                        <code class="bg-gray-100 px-2 py-1 rounded">Ctrl+E</code>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Start emotion analysis</span>
                        <code class="bg-gray-100 px-2 py-1 rounded">Ctrl+A</code>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Voice control</span>
                        <code class="bg-gray-100 px-2 py-1 rounded">Ctrl+V</code>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Eye tracking functionality
let eyeTrackingActive = false;
let voiceControlActive = false;
let signLanguageActive = false;

// Update dwell time display
document.getElementById('dwell-time').addEventListener('input', function() {
    const value = this.value;
    document.getElementById('dwell-time-display').textContent = (value / 1000).toFixed(1) + 's';
});

// Eye tracking toggle
async function toggleEyeTracking() {
    const toggle = document.getElementById('eye-tracking-toggle');
    const status = document.getElementById('eye-tracking-status');
    const controls = document.getElementById('eye-tracking-controls');
    
    if (!eyeTrackingActive) {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('eye-tracking-video').srcObject = stream;
            
            eyeTrackingActive = true;
            toggle.textContent = 'Stop';
            toggle.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            toggle.classList.add('bg-red-600', 'hover:bg-red-700');
            status.textContent = 'Active';
            status.classList.remove('bg-gray-200', 'text-gray-700');
            status.classList.add('bg-green-200', 'text-green-700');
            controls.classList.remove('hidden');
            
            startEyeTracking();
        } catch (error) {
            alert('Camera access required for eye tracking. Please allow camera access and try again.');
        }
    } else {
        const stream = document.getElementById('eye-tracking-video').srcObject;
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        eyeTrackingActive = false;
        toggle.textContent = 'Start';
        toggle.classList.remove('bg-red-600', 'hover:bg-red-700');
        toggle.classList.add('bg-blue-600', 'hover:bg-blue-700');
        status.textContent = 'Inactive';
        status.classList.remove('bg-green-200', 'text-green-700');
        status.classList.add('bg-gray-200', 'text-gray-700');
        controls.classList.add('hidden');
    }
}

function startEyeTracking() {
    // Simulate eye tracking (in real implementation, this would use MediaPipe)
    const gazeCursor = document.getElementById('gaze-cursor');
    gazeCursor.classList.remove('hidden');
    
    // Simulate gaze movement
    setInterval(() => {
        if (eyeTrackingActive) {
            const video = document.getElementById('eye-tracking-video');
            const rect = video.getBoundingClientRect();
            const x = Math.random() * rect.width;
            const y = Math.random() * rect.height;
            
            gazeCursor.style.left = x + 'px';
            gazeCursor.style.top = y + 'px';
        }
    }, 100);
}

// Voice control toggle
function toggleVoiceControl() {
    const toggle = document.getElementById('voice-control-toggle');
    const panel = document.getElementById('voice-control-panel');
    
    if (!voiceControlActive) {
        voiceControlActive = true;
        toggle.textContent = 'Disable';
        toggle.classList.remove('bg-green-600', 'hover:bg-green-700');
        toggle.classList.add('bg-red-600', 'hover:bg-red-700');
        panel.classList.remove('hidden');
        
        startVoiceRecognition();
    } else {
        voiceControlActive = false;
        toggle.textContent = 'Enable';
        toggle.classList.remove('bg-red-600', 'hover:bg-red-700');
        toggle.classList.add('bg-green-600', 'hover:bg-green-700');
        panel.classList.add('hidden');
        
        stopVoiceRecognition();
    }
}

function startVoiceRecognition() {
    if ('webkitSpeechRecognition' in window) {
        const recognition = new webkitSpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = document.getElementById('voice-language').value;
        
        recognition.onresult = function(event) {
            const result = event.results[event.results.length - 1];
            if (result.isFinal) {
                const command = result[0].transcript.toLowerCase();
                document.getElementById('voice-command-display').textContent = command;
                processVoiceCommand(command);
            }
        };
        
        recognition.start();
        window.voiceRecognition = recognition;
    } else {
        alert('Voice recognition not supported in this browser.');
    }
}

function stopVoiceRecognition() {
    if (window.voiceRecognition) {
        window.voiceRecognition.stop();
    }
}

function processVoiceCommand(command) {
    if (command.includes('emotion analysis')) {
        window.location.href = '/emotion-analysis';
    } else if (command.includes('therapy')) {
        window.location.href = '/therapy-session';
    } else if (command.includes('breathing')) {
        window.location.href = '/therapy-session#breathing';
    } else if (command.includes('dashboard')) {
        window.location.href = '/dashboard';
    } else if (command.includes('emergency') || command.includes('help')) {
        window.location.href = '/crisis-support';
    }
}

// Sign language toggle
async function toggleSignLanguage() {
    const toggle = document.getElementById('sign-language-toggle');
    const controls = document.getElementById('sign-language-controls');
    
    if (!signLanguageActive) {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('sign-language-video').srcObject = stream;
            
            signLanguageActive = true;
            toggle.textContent = 'Stop';
            toggle.classList.remove('bg-purple-600', 'hover:bg-purple-700');
            toggle.classList.add('bg-red-600', 'hover:bg-red-700');
            controls.classList.remove('hidden');
            
            startSignLanguageDetection();
        } catch (error) {
            alert('Camera access required for sign language recognition.');
        }
    } else {
        const stream = document.getElementById('sign-language-video').srcObject;
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        
        signLanguageActive = false;
        toggle.textContent = 'Start';
        toggle.classList.remove('bg-red-600', 'hover:bg-red-700');
        toggle.classList.add('bg-purple-600', 'hover:bg-purple-700');
        controls.classList.add('hidden');
    }
}

function startSignLanguageDetection() {
    // Simulate sign language detection
    const overlay = document.getElementById('sign-language-overlay');
    const detectedSign = document.getElementById('detected-sign');
    const translation = document.getElementById('sign-translation');
    
    overlay.classList.remove('hidden');
    
    const signs = [
        { emoji: 'üëã', text: 'Hello' },
        { emoji: 'üëç', text: 'Good' },
        { emoji: '‚ù§Ô∏è', text: 'Love' },
        { emoji: 'üôè', text: 'Thank you' },
        { emoji: '‚úã', text: 'Stop' }
    ];
    
    setInterval(() => {
        if (signLanguageActive) {
            const randomSign = signs[Math.floor(Math.random() * signs.length)];
            detectedSign.textContent = randomSign.emoji;
            translation.textContent = randomSign.text;
        }
    }, 3000);
}

// Accessibility settings
function toggleHighContrast() {
    document.body.classList.toggle('high-contrast');
}

function toggleLargeText() {
    document.body.classList.toggle('large-text');
}

function toggleReducedMotion() {
    document.body.classList.toggle('reduced-motion');
}

function toggleScreenReader() {
    // Enhanced ARIA labels and descriptions
    const screenReaderMode = document.getElementById('screen-reader').checked;
    
    if (screenReaderMode) {
        // Add more descriptive ARIA labels
        document.querySelectorAll('button').forEach(btn => {
            if (!btn.getAttribute('aria-label')) {
                btn.setAttribute('aria-label', btn.textContent + ' button');
            }
        });
    }
}

function showAccessibilityGuide() {
    alert('Accessibility Guide:\n\n' +
          '‚Ä¢ Use Tab to navigate between elements\n' +
          '‚Ä¢ Press Enter or Space to activate buttons\n' +
          '‚Ä¢ Use arrow keys in form controls\n' +
          '‚Ä¢ Enable eye tracking for hands-free navigation\n' +
          '‚Ä¢ Use voice commands with "Hey Aarohan"\n' +
          '‚Ä¢ Sign language support available\n' +
          '‚Ä¢ High contrast mode improves visibility\n' +
          '‚Ä¢ Large text option increases readability');
}

// Keyboard shortcuts
document.addEventListener('keydown', function(event) {
    if (event.ctrlKey || event.metaKey) {
        switch(event.key) {
            case 'e':
                event.preventDefault();
                window.location.href = '/crisis-support';
                break;
            case 'a':
                event.preventDefault();
                window.location.href = '/emotion-analysis';
                break;
            case 'v':
                event.preventDefault();
                toggleVoiceControl();
                break;
        }
    }
});

// Save accessibility preferences
function saveAccessibilityPreferences() {
    const preferences = {
        highContrast: document.getElementById('high-contrast').checked,
        largeText: document.getElementById('large-text').checked,
        reducedMotion: document.getElementById('reduced-motion').checked,
        screenReader: document.getElementById('screen-reader').checked
    };
    
    localStorage.setItem('aarohanAccessibilityPreferences', JSON.stringify(preferences));
}

// Load accessibility preferences
function loadAccessibilityPreferences() {
    const saved = localStorage.getItem('aarohanAccessibilityPreferences');
    if (saved) {
        const preferences = JSON.parse(saved);
        
        document.getElementById('high-contrast').checked = preferences.highContrast;
        document.getElementById('large-text').checked = preferences.largeText;
        document.getElementById('reduced-motion').checked = preferences.reducedMotion;
        document.getElementById('screen-reader').checked = preferences.screenReader;
        
        // Apply saved preferences
        if (preferences.highContrast) toggleHighContrast();
        if (preferences.largeText) toggleLargeText();
        if (preferences.reducedMotion) toggleReducedMotion();
        if (preferences.screenReader) toggleScreenReader();
    }
}

// Auto-save preferences when changed
document.querySelectorAll('#high-contrast, #large-text, #reduced-motion, #screen-reader').forEach(checkbox => {
    checkbox.addEventListener('change', saveAccessibilityPreferences);
});

// Load preferences on page load
document.addEventListener('DOMContentLoaded', loadAccessibilityPreferences);
</script>

<style>
/* Accessibility styles */
.high-contrast {
    filter: contrast(150%);
}

.large-text {
    font-size: 120%;
}

.reduced-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Focus indicators */
button:focus, input:focus, select:focus, textarea:focus {
    outline: 3px solid #4F46E5;
    outline-offset: 2px;
}

/* High contrast specific styles */
@media (prefers-contrast: high) {
    .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        border: 2px solid #000;
    }
}
</style>
{% endblock %}
