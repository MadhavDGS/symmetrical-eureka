{% extends "base.html" %}

{% block title %}Fitness Tracker - Aarohan{% endblock %}

{% block extra_head %}
<style> /* Enhanced Accessibility Styles */ .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; } .keyboard-focus { outline: 3px solid #4F46E5 !important; outline-offset: 2px; } /* High contrast mode */ .high-contrast { filter: contrast(150%); } .high-contrast .bg-white { background-color: #ffffff !important; color: #000000 !important; } .high-contrast .bg-blue-50 { background-color: #000080 !important; color: #ffffff !important; } /* Reduced motion preferences */ .reduced-motion * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; } /* Focus management */ button:focus-visible, [tabindex]:focus-visible { outline: 2px solid #4F46E5; outline-offset: 2px; } /* Status indicators for screen readers */ .status-active::before { content: "Active: "; font-weight: bold; } .status-inactive::before { content: "Inactive: "; font-weight: bold; } /* Camera and device integration styles */ #cameraFeed { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } #analysisCanvas { position: absolute; top: 0; left: 0; opacity: 0.3; pointer-events: none; } .device-connection-status { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 8px; } .device-connected { background-color: #10B981; } .device-disconnected { background-color: #EF4444; } /* Performance monitoring styles */ #performance-metrics { user-select: none; backdrop-filter: blur(10px); } /* Improved touch targets */ @media (max-width: 768px) { button { min-height: 44px; min-width: 44px; padding: 12px; } } /* Animation for health status updates */ @keyframes healthUpdate { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } } .health-metric-updated { animation: healthUpdate 0.3s ease-in-out; } /* Ensure sufficient color contrast */ .text-green-600 { color: #059669 !important; } .text-red-600 { color: #DC2626 !important; } .text-yellow-600 { color: #D97706 !important; } /* Emergency alert accessibility */ .emergency-alert { border: 3px solid #EF4444; background: #FEE2E2; } .emergency-alert h2 { color: #DC2626; } .activity-btn { transition: all 0.0.3s ease-in-out; border: 2px solid transparent; } .activity-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); } .activity-btn.selected { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; } .activity-icon { font-size: 24px; margin-bottom: 8px; }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"> <!-- Header Section with Semantic HTML and ARIA --> <header class="text-center mb-8" role="banner"> <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4" id="main-heading" aria-label="Fitness and Health Tracker Application"> 💓 Fitness & Health Tracker </h1> <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto" role="doc-subtitle" aria-describedby="main-heading"> Monitor your vital signs, track fitness activities, and maintain optimal health with AI-powered insights </p> <!-- Live Region for Status Updates --> <div id="status-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div> </header> <!-- Real-time Health Metrics Dashboard with Semantic Structure --> <section class="mb-8" role="region" aria-labelledby="health-metrics-heading"> <h2 id="health-metrics-heading" class="sr-only">Real-time Health Metrics</h2> <div class="grid grid-cols-1 md:grid-cols-4 gap-6" role="group" aria-label="Health vital signs display"> <!-- Heart Rate with Enhanced Accessibility --> <article class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg text-center" role="region" aria-labelledby="heart-rate-label" tabindex="0"> <header class="flex items-center justify-center mb-3"> <div class="w-12 h-12 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center" role="img" aria-label="Heart rate indicator"> <span class="text-2xl" aria-hidden="true">❤️</span> </div> </header> <div class="text-3xl font-bold text-red-600 mb-1" id="heartRate" role="status" aria-label="Current heart rate" aria-describedby="heart-rate-unit heart-rate-status">72</div> <div class="text-sm text-gray-600 dark:text-gray-400" id="heart-rate-unit">BPM</div> <div class="text-xs text-green-600 mt-1" id="heartRateStatus" role="status" aria-label="Heart rate status">Normal</div> <span id="heart-rate-label" class="sr-only">Heart Rate Monitor</span> </article> <!-- SpO2 (Blood Oxygen) with Device Integration --> <article class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg text-center" role="region" aria-labelledby="spo2-label" tabindex="0"> <header class="flex items-center justify-center mb-3"> <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center" role="img" aria-label="Blood oxygen level indicator"> <span class="text-2xl" aria-hidden="true">🫁</span> </div> <button id="connectPulseOximeter" class="ml-2 text-xs bg-blue-100 hover:bg-blue-200 px-2 py-1 rounded" aria-label="Connect pulse oximeter via Bluetooth" title="Connect Bluetooth pulse oximeter"> 📶 Connect </button> </header> <div class="text-3xl font-bold text-blue-600 mb-1" id="spo2" role="status" aria-label="Current blood oxygen saturation" aria-describedby="spo2-unit spo2-status">98</div> <div class="text-sm text-gray-600 dark:text-gray-400" id="spo2-unit">%</div> <div class="text-xs text-green-600 mt-1" id="spo2Status" role="status" aria-label="Oxygen saturation status">Excellent</div> <span id="spo2-label" class="sr-only">Blood Oxygen Saturation Monitor</span> </article> <!-- Blood Pressure --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg text-center"> <div class="flex items-center justify-center mb-3"> <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center"> <span class="text-2xl">🩺</span> </div> </div> <div class="text-2xl font-bold text-purple-600 mb-1" id="bloodPressure">120/80</div> <div class="text-sm text-gray-600 dark:text-gray-400">mmHg</div> <div class="text-xs text-green-600 mt-1" id="bpStatus">Optimal</div> </div> <!-- Body Temperature --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg text-center"> <div class="flex items-center justify-center mb-3"> <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center"> <span class="text-2xl">🌡️</span> </div> </div> <div class="text-3xl font-bold text-orange-600 mb-1" id="temperature">98.6</div> <div class="text-sm text-gray-600 dark:text-gray-400">°F</div> <div class="text-xs text-green-600 mt-1" id="tempStatus">Normal</div> </div> </div> <!-- Camera-based Health Monitoring Section --> <section class="mb-8" role="region" aria-labelledby="camera-monitoring-heading"> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg"> <h2 id="camera-monitoring-heading" class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"> 📹 Camera-Based Health Monitoring </h2> <!-- Camera Controls --> <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4 mb-6"> <button id="startCameraMonitoring" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium" aria-describedby="camera-monitoring-desc"> 📸 Start Camera Heart Rate Detection </button> <button id="emotionDetection" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium" aria-describedby="emotion-detection-desc"> 😊 Emotion Analysis </button> <button id="requestLocationContext" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium" aria-describedby="location-context-desc"> 📍 Location Context </button> </div> <!-- Video Feed Container --> <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 text-center"> <video id="cameraFeed" class="w-full max-w-md mx-auto rounded-lg hidden" autoplay muted aria-label="Live camera feed for health monitoring"></video> <canvas id="analysisCanvas" class="hidden" aria-hidden="true"></canvas> <div id="cameraPlaceholder" class="py-8"> <div class="text-6xl mb-4">📷</div> <p class="text-gray-600 dark:text-gray-300">Click "Start Camera" to begin visual health monitoring</p> <p class="text-sm text-gray-500 dark:text-gray-400 mt-2"> Detect heart rate through facial blood flow analysis and emotional state assessment </p> </div> </div> <!-- Camera Analysis Results --> <div id="cameraResults" class="hidden"> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg"> <h3 class="font-medium text-red-800 dark:text-red-300">❤️ Camera Heart Rate</h3> <div class="text-2xl font-bold text-red-600" id="cameraHeartRate">--</div> <div class="text-sm text-red-700 dark:text-red-400">BPM (via facial analysis)</div> </div> <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg"> <h3 class="font-medium text-purple-800 dark:text-purple-300">😊 Emotional State</h3> <div class="text-lg font-bold text-purple-600" id="emotionResult">--</div> <div class="text-sm text-purple-700 dark:text-purple-400" id="emotionConfidence">--</div> </div> <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg"> <h3 class="font-medium text-blue-800 dark:text-blue-300">📍 Health Context</h3> <div class="text-sm text-blue-600" id="locationContext">--</div> <div class="text-xs text-blue-700 dark:text-blue-400" id="environmentalFactors">--</div> </div> </div> </div> <!-- Accessibility Descriptions --> <div class="sr-only"> <p id="camera-monitoring-desc">Uses your device camera to detect heart rate through facial blood flow analysis</p> <p id="emotion-detection-desc">Analyzes facial expressions to determine emotional state for wellness assessment</p> <p id="location-context-desc">Uses location data to provide context-aware health recommendations</p> </div> </div> </section> <!-- Real-time Monitoring --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg"> <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"> 📊 Real-time Health Monitoring </h2> <!-- Monitoring Controls --> <div class="flex justify-center space-x-4 mb-6"> <button id="startMonitoring" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium"> Start Monitoring </button> <button id="stopMonitoring" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium" disabled> Stop Monitoring </button> <button id="syncData" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium"> Sync with Google Fit </button> </div> <!-- Live Chart Container --> <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 h-64 mb-4"> <div class="flex items-center justify-center h-full"> <div id="healthChart" class="w-full h-full"> <canvas id="vitalsChart" width="400" height="200"></canvas> </div> </div> </div> <!-- Current Session Info --> <div class="grid grid-cols-2 gap-4 text-sm"> <div class="text-center"> <div class="font-medium text-gray-700 dark:text-gray-300">Session Duration</div> <div class="text-lg font-bold text-blue-600" id="sessionDuration">00:00</div> </div> <div class="text-center"> <div class="font-medium text-gray-700 dark:text-gray-300">Data Points</div> <div class="text-lg font-bold text-green-600" id="dataPoints">0</div> </div> </div> </div> <!-- Health Insights & AI Analysis --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg"> <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"> 🤖 AI Health Insights </h2> <!-- AI Analysis Results --> <div id="aiInsights" class="space-y-4 mb-6"> <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4"> <h3 class="font-medium text-green-800 dark:text-green-300 mb-2">✅ Overall Health Status</h3> <p class="text-sm text-green-700 dark:text-green-400">Your vital signs are within normal ranges. Keep up the great work!</p> </div> <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"> <h3 class="font-medium text-blue-800 dark:text-blue-300 mb-2">💡 Recommendations</h3> <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1"> <li>• Maintain regular hydration throughout the day</li> <li>• Consider 30 minutes of moderate exercise</li> <li>• Monitor stress levels during peak hours</li> </ul> </div> </div> <!-- Get AI Analysis Button --> <button id="getAiAnalysis" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium mb-4"> 🧠 Get AI Health Analysis </button> <!-- Health Trends --> <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4"> <h3 class="font-medium text-gray-900 dark:text-white mb-3">📈 24-Hour Trends</h3> <div class="space-y-2 text-sm"> <div class="flex justify-between"> <span class="text-gray-600 dark:text-gray-400">Avg Heart Rate:</span> <span class="font-medium text-red-600">74 BPM</span> </div> <div class="flex justify-between"> <span class="text-gray-600 dark:text-gray-400">Avg SpO2:</span> <span class="font-medium text-blue-600">97.8%</span> </div> <div class="flex justify-between"> <span class="text-gray-600 dark:text-gray-400">Resting HR:</span> <span class="font-medium text-green-600">68 BPM</span> </div> <div class="flex justify-between"> <span class="text-gray-600 dark:text-gray-400">Max HR Today:</span> <span class="font-medium text-orange-600">95 BPM</span> </div> </div> </div> </div> <!-- Fitness Activities --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg"> <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"> 🏃‍♂️ Fitness Activities </h2> <!-- Activity Selection --> <div class="grid grid-cols-2 gap-3 mb-6"> <button class="activity-btn bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 p-3 rounded-lg text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-800" data-activity="walking"> 🚶‍♂️ Walking </button> <button class="activity-btn bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 p-3 rounded-lg text-sm font-medium hover:bg-green-200 dark:hover:bg-green-800" data-activity="running"> 🏃‍♂️ Running </button> <button class="activity-btn bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 p-3 rounded-lg text-sm font-medium hover:bg-purple-200 dark:hover:bg-purple-800" data-activity="cycling"> 🚴‍♂️ Cycling </button> <button class="activity-btn bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 p-3 rounded-lg text-sm font-medium hover:bg-orange-200 dark:hover:bg-orange-800" data-activity="yoga"> 🧘‍♀️ Yoga </button> </div> <!-- Current Activity --> <div id="currentActivity" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4"> <h3 class="font-medium text-gray-900 dark:text-white mb-3">Current Activity: <span id="activityName">None</span></h3> <div class="grid grid-cols-3 gap-4 text-center"> <div> <div class="text-lg font-bold text-blue-600" id="duration">00:00</div> <div class="text-xs text-gray-600 dark:text-gray-400">Duration</div> </div> <div> <div class="text-lg font-bold text-green-600" id="calories">0</div> <div class="text-xs text-gray-600 dark:text-gray-400">Calories</div> </div> <div> <div class="text-lg font-bold text-purple-600" id="distance">0.0</div> <div class="text-xs text-gray-600 dark:text-gray-400">km</div> </div> </div> </div> <!-- Activity Controls --> <div class="flex space-x-3"> <button id="startActivity" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium" disabled> Start Activity </button> <button id="stopActivity" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium" disabled> Stop Activity </button> </div> </div> <!-- Health Goals & Progress --> <div class="bg-white dark:bg-dark-800 rounded-xl p-6 shadow-lg"> <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center"> Health Goals & Progress </h2> <!-- Daily Goals --> <div class="space-y-4 mb-6"> <!-- Steps Goal --> <div> <div class="flex justify-between items-center mb-2"> <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Daily Steps</span> <span class="text-sm text-blue-600" id="stepsProgress">6,500 / 10,000</span> </div> <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"> <div class="bg-blue-600 h-2 rounded-full" style="width: 65%" id="stepsBar"></div> </div> </div> <!-- Heart Rate Zone Goal --> <div> <div class="flex justify-between items-center mb-2"> <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Heart Rate Zone Time</span> <span class="text-sm text-red-600" id="hrZoneProgress">25 / 30 min</span> </div> <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"> <div class="bg-red-600 h-2 rounded-full" style="width: 83%" id="hrZoneBar"></div> </div> </div> <!-- Active Calories Goal --> <div> <div class="flex justify-between items-center mb-2"> <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Active Calories</span> <span class="text-sm text-green-600" id="caloriesProgress">420 / 500 kcal</span> </div> <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2"> <div class="bg-green-600 h-2 rounded-full" style="width: 84%" id="caloriesBar"></div> </div> </div> </div> <!-- Weekly Challenge --> <div class="bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900 rounded-lg p-4"> <h3 class="font-medium text-purple-800 dark:text-purple-200 mb-2">🏆 Weekly Challenge</h3> <p class="text-sm text-purple-700 dark:text-purple-300 mb-3">Maintain SpO2 above 95% for 7 consecutive days</p> <div class="flex space-x-1"> <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"> <span class="text-xs text-white">✓</span> </div> <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"> <span class="text-xs text-white">✓</span> </div> <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"> <span class="text-xs text-white">✓</span> </div> <div class="w-6 h-6 bg-purple-300 rounded-full flex items-center justify-center"> <span class="text-xs text-purple-600">4</span> </div> <div class="w-6 h-6 bg-gray-300 rounded-full"></div> <div class="w-6 h-6 bg-gray-300 rounded-full"></div> <div class="w-6 h-6 bg-gray-300 rounded-full"></div> </div> </div> </div> </div> <!-- Emergency Alert Modal (Hidden by default) --> <div id="emergencyModal" class="hidden fixed inset-0 bg-red-900 bg-opacity-75 flex items-center justify-center z-50"> <div class="bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md mx-4 text-center"> <div class="text-6xl mb-4">🚨</div> <h3 class="text-xl font-bold text-red-600 mb-4">Health Alert!</h3> <p class="text-gray-700 dark:text-gray-300 mb-6" id="alertMessage">Abnormal vital signs detected.</p> <div class="space-y-3"> <button id="callEmergency" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium"> 📞 Call Emergency Services </button> <button id="dismissAlert" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium"> Dismiss Alert </button> </div> </div> </div>
</div>

<script>
// Enhanced Fitness Tracker with Device APIs and Accessibility
class FitnessTracker { constructor() { this.isMonitoring = false; this.currentActivity = null; this.sessionStartTime = null; this.activityStartTime = null; this.dataPoints = 0; this.healthData = []; this.googleApiKey = 'AIzaSyCqS7EtO9ZSPyAOTN41HV9xofPK-rwDIL4'; // Device API support flags this.deviceSupport = { webBluetooth: 'bluetooth' in navigator, mediaDevices: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia), geolocation: 'geolocation' in navigator, deviceMotion: 'DeviceMotionEvent' in window, deviceOrientation: 'DeviceOrientationEvent' in window }; // Health device connections this.connectedDevices = { pulseOximeter: null, heartRateMonitor: null, bloodPressureMonitor: null }; // Camera and MediaStream references this.mediaStream = null; this.analysisContext = null; this.emotionDetectionActive = false; // Performance monitoring this.performanceMetrics = { startTime: performance.now(), memoryUsage: [], loadTime: 0, interactionTime: 0 }; // Accessibility features this.accessibilitySettings = { announceUpdates: true, keyboardNavigation: true, highContrast: false, reducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches }; // Health ranges with more comprehensive data this.healthRanges = { heartRate: { min: 60, max: 100, ideal: { min: 70, max: 85 } }, spo2: { min: 95, max: 100, ideal: { min: 97, max: 100 } }, systolic: { min: 90, max: 120, ideal: { min: 110, max: 120 } }, diastolic: { min: 60, max: 80, ideal: { min: 70, max: 80 } }, temperature: { min: 97.0, max: 99.5, ideal: { min: 98.0, max: 99.0 } } }; this.initializeDeviceSupport(); this.initializeEventListeners(); this.initializeAccessibility(); this.measurePerformance(); this.updateDisplay(); console.log('Enhanced Fitness Tracker initialized:', { deviceSupport: this.deviceSupport, performanceSupport: true, accessibilityFeatures: this.accessibilitySettings }); } initializeDeviceSupport() { // Report device capabilities this.announceToScreenReader(`Device capabilities detected: ${this.deviceSupport.webBluetooth ? 'Bluetooth health devices supported' : 'Bluetooth not available'}, ${this.deviceSupport.mediaDevices ? 'Camera monitoring available' : 'Camera access not available'}, ${this.deviceSupport.geolocation ? 'Location context enabled' : 'Location services not available'}`); } initializeEventListeners() { // Traditional monitoring controls document.getElementById('startMonitoring')?.addEventListener('click', () => this.startMonitoring()); document.getElementById('stopMonitoring')?.addEventListener('click', () => this.stopMonitoring()); document.getElementById('syncData')?.addEventListener('click', () => this.syncWithGoogleFit()); // AI Analysis document.getElementById('getAiAnalysis')?.addEventListener('click', () => this.getAiHealthAnalysis()); // Camera-based monitoring document.getElementById('startCameraMonitoring')?.addEventListener('click', () => this.startCameraMonitoring()); document.getElementById('emotionDetection')?.addEventListener('click', () => this.startEmotionDetection()); document.getElementById('requestLocationContext')?.addEventListener('click', () => this.requestLocationContext()); // Bluetooth device connections document.getElementById('connectPulseOximeter')?.addEventListener('click', () => this.connectBluetoothDevice('pulse-oximeter')); // Activity controls document.querySelectorAll('.activity-btn').forEach(btn => { btn.addEventListener('click', (e) => this.selectActivity(e.target.dataset.activity)); }); document.getElementById('startActivity')?.addEventListener('click', () => this.startActivity()); document.getElementById('stopActivity')?.addEventListener('click', () => this.stopActivity()); // Emergency modal document.getElementById('dismissAlert')?.addEventListener('click', () => this.dismissEmergencyAlert()); document.getElementById('callEmergency')?.addEventListener('click', () => this.callEmergencyServices()); // Keyboard accessibility document.addEventListener('keydown', (e) => this.handleKeyboardNavigation(e)); // Device motion/orientation events if (this.deviceSupport.deviceMotion) { window.addEventListener('devicemotion', (e) => this.handleDeviceMotion(e)); } // Page visibility for performance optimization document.addEventListener('visibilitychange', () => this.handleVisibilityChange()); } // === DEVICE API INTEGRATIONS === async connectBluetoothDevice(deviceType) { if (!this.deviceSupport.webBluetooth) { this.announceToScreenReader('Bluetooth not supported on this device'); this.showToast('❌ Bluetooth not supported on this device'); return; } try { this.showToast('🔍 Searching for Bluetooth health devices...'); let serviceUUID; switch (deviceType) { case 'pulse-oximeter': serviceUUID = 0x1822; // Pulse Oximeter Service break; case 'heart-rate': serviceUUID = 0x180D; // Heart Rate Service break; case 'blood-pressure': serviceUUID = 0x1810; // Blood Pressure Service break; default: serviceUUID = 0x180F; // Battery Service (generic) } const device = await navigator.bluetooth.requestDevice({ filters: [{ services: [serviceUUID] }], optionalServices: ['battery_service'] }); const server = await device.gatt.connect(); const service = await server.getPrimaryService(serviceUUID); this.connectedDevices[deviceType.replace('-', '')] = { device, server, service }; this.announceToScreenReader(`${deviceType} connected successfully`); this.showToast(`✅ ${deviceType} connected successfully`); // Start receiving data from the device this.startBluetoothDataStream(deviceType, service); } catch (error) { console.error('Bluetooth connection failed:', error); this.showToast(`❌ Failed to connect to ${deviceType}`); } } async startBluetoothDataStream(deviceType, service) { try { const characteristics = await service.getCharacteristics(); for (const characteristic of characteristics) { if (characteristic.properties.notify) { await characteristic.startNotifications(); characteristic.addEventListener('characteristicvaluechanged', (event) => { this.handleBluetoothData(deviceType, event.target.value); }); } } } catch (error) { console.error('Failed to start Bluetooth data stream:', error); } } handleBluetoothData(deviceType, dataValue) { // Parse Bluetooth data based on device type const data = new Uint8Array(dataValue.buffer); switch (deviceType) { case 'pulse-oximeter': const spo2 = data[1]; const pulseRate = data[2]; document.getElementById('spo2').textContent = spo2; document.getElementById('heartRate').textContent = pulseRate; this.announceToScreenReader(`SpO2 updated to ${spo2}%, Pulse rate ${pulseRate} BPM`); break; case 'heart-rate': const heartRate = data[1]; document.getElementById('heartRate').textContent = heartRate; this.announceToScreenReader(`Heart rate updated to ${heartRate} BPM`); break; } } async startCameraMonitoring() { if (!this.deviceSupport.mediaDevices) { this.showToast('❌ Camera access not available'); return; } try { this.showToast('📸 Requesting camera access...'); this.mediaStream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480, facingMode: 'user' } }); const videoElement = document.getElementById('cameraFeed'); const canvas = document.getElementById('analysisCanvas'); videoElement.srcObject = this.mediaStream; videoElement.classList.remove('hidden'); document.getElementById('cameraPlaceholder').classList.add('hidden'); document.getElementById('cameraResults').classList.remove('hidden'); this.analysisContext = canvas.getContext('2d'); canvas.width = 640; canvas.height = 480; // Start heart rate detection via camera this.startCameraHeartRateDetection(); this.announceToScreenReader('Camera monitoring started. Heart rate detection active.'); this.showToast('✅ Camera monitoring started'); } catch (error) { console.error('Camera access failed:', error); this.showToast('❌ Camera access denied or failed'); } } startCameraHeartRateDetection() { const video = document.getElementById('cameraFeed'); const canvas = document.getElementById('analysisCanvas'); let frameCount = 0; let redValues = []; const analyzeFrame = () => { if (!this.mediaStream || !video.videoWidth) { requestAnimationFrame(analyzeFrame); return; } // Draw current frame to canvas this.analysisContext.drawImage(video, 0, 0, canvas.width, canvas.height); // Extract facial region (simplified - center 200x200 region) const centerX = canvas.width / 2; const centerY = canvas.height / 2; const regionSize = 100; const imageData = this.analysisContext.getImageData( centerX - regionSize, centerY - regionSize, regionSize * 2, regionSize * 2 ); // Calculate average red channel intensity let redSum = 0; for (let i = 0; i < imageData.data.length; i += 4) { redSum += imageData.data[i]; // Red channel } const avgRed = redSum / (imageData.data.length / 4); redValues.push(avgRed); // Keep only last 300 frames (10 seconds at 30fps) if (redValues.length > 300) { redValues.shift(); } // Calculate heart rate every 30 frames (1 second) if (frameCount % 30 === 0 && redValues.length > 150) { const heartRate = this.calculateHeartRateFromRedChannel(redValues); document.getElementById('cameraHeartRate').textContent = heartRate; this.announceToScreenReader(`Camera detected heart rate: ${heartRate} BPM`); } frameCount++; requestAnimationFrame(analyzeFrame); }; analyzeFrame(); } calculateHeartRateFromRedChannel(redValues) { // Simplified heart rate calculation from red channel variations // In production, this would use more sophisticated signal processing if (redValues.length < 150) return '--'; // Apply simple moving average filter const filtered = []; const windowSize = 5; for (let i = windowSize; i < redValues.length - windowSize; i++) { let sum = 0; for (let j = i - windowSize; j <= i + windowSize; j++) { sum += redValues[j]; } filtered.push(sum / (windowSize * 2 + 1)); } // Find peaks (simplified peak detection) let peaks = 0; for (let i = 1; i < filtered.length - 1; i++) { if (filtered[i] > filtered[i-1] && filtered[i] > filtered[i+1]) { const prominence = Math.min( filtered[i] - filtered[i-1], filtered[i] - filtered[i+1] ); if (prominence > 1) { // Threshold for significant peak peaks++; } } } // Calculate BPM (assuming 30 FPS, 5 seconds of data) const timeSpan = filtered.length / 30; // seconds const bpm = Math.round((peaks / timeSpan) * 60); // Sanity check for reasonable heart rate return (bpm >= 50 && bpm <= 150) ? bpm : '--'; } async startEmotionDetection() { if (!this.mediaStream) { await this.startCameraMonitoring(); } this.emotionDetectionActive = true; this.showToast('😊 Emotion detection started'); // Simulate emotion detection (in production, this would use ML models) setTimeout(() => { const emotions = ['Happy', 'Calm', 'Focused', 'Relaxed', 'Neutral']; const confidence = [85, 92, 78, 88, 70]; const randomIndex = Math.floor(Math.random() * emotions.length); const detectedEmotion = emotions[randomIndex]; const confidenceLevel = confidence[randomIndex]; document.getElementById('emotionResult').textContent = detectedEmotion; document.getElementById('emotionConfidence').textContent = `${confidenceLevel}% confidence`; this.announceToScreenReader(`Emotion detected: ${detectedEmotion} with ${confidenceLevel}% confidence`); }, 2000); } async requestLocationContext() { if (!this.deviceSupport.geolocation) { this.showToast('❌ Location services not available'); return; } this.showToast('📍 Requesting location for health context...'); navigator.geolocation.getCurrentPosition( (position) => { const { latitude, longitude } = position.coords; // Simulate environmental health context this.getEnvironmentalHealthContext(latitude, longitude); this.announceToScreenReader('Location context updated for personalized health recommendations'); }, (error) => { console.error('Geolocation failed:', error); this.showToast('❌ Location access denied or failed'); }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000 } ); } getEnvironmentalHealthContext(lat, lng) { // Simulate environmental health factors based on location const contexts = [ 'Urban environment: Monitor air quality impact on respiratory health', 'High altitude detected: Expect lower SpO2 baseline (normal for altitude)', 'Coastal area: Optimal humidity levels for respiratory wellness', 'Temperate climate: Ideal conditions for outdoor exercise', 'Indoor environment detected: Ensure adequate ventilation' ]; const environmentalFactors = [ 'Temperature: 72°F, Humidity: 45%', 'Air Quality Index: Good (35)', 'UV Index: Moderate (4)', 'Pollen Count: Low' ]; const randomContext = contexts[Math.floor(Math.random() * contexts.length)]; const randomFactors = environmentalFactors[Math.floor(Math.random() * environmentalFactors.length)]; document.getElementById('locationContext').textContent = randomContext; document.getElementById('environmentalFactors').textContent = randomFactors; } // === ACCESSIBILITY FEATURES === initializeAccessibility() { // Check for accessibility preferences if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { this.accessibilitySettings.reducedMotion = true; document.body.classList.add('reduced-motion'); } if (window.matchMedia('(prefers-contrast: high)').matches) { this.accessibilitySettings.highContrast = true; document.body.classList.add('high-contrast'); } // Setup focus management this.initializeFocusManagement(); // Initialize ARIA live regions this.initializeAriaLiveRegions(); console.log('Accessibility features initialized:', this.accessibilitySettings); } initializeFocusManagement() { // Ensure all interactive elements are keyboard accessible const interactiveElements = document.querySelectorAll('button, [tabindex], input, select, textarea'); interactiveElements.forEach((element, index) => { if (!element.hasAttribute('tabindex')) { element.setAttribute('tabindex', '0'); } // Add focus indicators element.addEventListener('focus', (e) => { e.target.classList.add('keyboard-focus'); }); element.addEventListener('blur', (e) => { e.target.classList.remove('keyboard-focus'); }); }); } initializeAriaLiveRegions() { // Create or verify ARIA live regions exist let statusRegion = document.getElementById('status-announcements'); if (!statusRegion) { statusRegion = document.createElement('div'); statusRegion.id = 'status-announcements'; statusRegion.setAttribute('aria-live', 'polite'); statusRegion.setAttribute('aria-atomic', 'true'); statusRegion.className = 'sr-only'; document.body.appendChild(statusRegion); } let alertRegion = document.getElementById('alert-announcements'); if (!alertRegion) { alertRegion = document.createElement('div'); alertRegion.id = 'alert-announcements'; alertRegion.setAttribute('aria-live', 'assertive'); alertRegion.setAttribute('aria-atomic', 'true'); alertRegion.className = 'sr-only'; document.body.appendChild(alertRegion); } } announceToScreenReader(message, priority = 'polite') { if (!this.accessibilitySettings.announceUpdates) return; const regionId = priority === 'assertive' ? 'alert-announcements' : 'status-announcements'; const region = document.getElementById(regionId); if (region) { // Clear previous message region.textContent = ''; // Add new message after a brief delay to ensure it's announced setTimeout(() => { region.textContent = message; }, 100); // Clear message after announcement setTimeout(() => { region.textContent = ''; }, 3000); } console.log(`Screen reader announcement (${priority}):`, message); } handleKeyboardNavigation(event) { if (!this.accessibilitySettings.keyboardNavigation) return; const { key, ctrlKey, altKey, metaKey } = event; // Emergency shortcut: Ctrl+Shift+E if (ctrlKey && event.shiftKey && key === 'E') { event.preventDefault(); this.handleEmergencyKeyboard(); return; } // Quick monitoring toggle: Space bar (when focused on main controls) if (key === ' ' && document.activeElement.id === 'startMonitoring') { event.preventDefault(); if (!this.isMonitoring) { this.startMonitoring(); } else { this.stopMonitoring(); } return; } // Activity navigation with arrow keys if (document.activeElement.classList.contains('activity-btn')) { const buttons = Array.from(document.querySelectorAll('.activity-btn')); const currentIndex = buttons.indexOf(document.activeElement); let nextIndex = currentIndex; switch (key) { case 'ArrowLeft': case 'ArrowUp': nextIndex = (currentIndex - 1 + buttons.length) % buttons.length; break; case 'ArrowRight': case 'ArrowDown': nextIndex = (currentIndex + 1) % buttons.length; break; case 'Enter': case ' ': event.preventDefault(); document.activeElement.click(); return; } if (nextIndex !== currentIndex) { event.preventDefault(); buttons[nextIndex].focus(); } } } handleEmergencyKeyboard() { // Emergency keyboard shortcut handler this.announceToScreenReader('Emergency mode activated', 'assertive'); // Show emergency modal if health metrics are critical const heartRate = parseInt(document.getElementById('heartRate').textContent) || 0; const spo2 = parseInt(document.getElementById('spo2').textContent) || 0; if (heartRate > 120 || heartRate < 50 || spo2 < 90) { this.showEmergencyAlert(); } else { this.showToast('✅ Health metrics normal. Emergency services contact available if needed.'); } } // === PERFORMANCE MONITORING === measurePerformance() { // Measure page load performance window.addEventListener('load', () => { const loadTime = performance.now() - this.performanceMetrics.startTime; this.performanceMetrics.loadTime = Math.round(loadTime); // Measure memory usage if available if (performance.memory) { this.performanceMetrics.memoryUsage.push({ timestamp: Date.now(), used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024), // MB total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) // MB }); } console.log('Performance metrics:', { loadTime: `${loadTime}ms`, memoryUsage: this.performanceMetrics.memoryUsage[0] || 'Not available', domElements: document.querySelectorAll('*').length }); // Display performance in dev mode if (window.location.search.includes('debug=true')) { this.displayPerformanceMetrics(); } }); // Measure interaction responsiveness document.addEventListener('click', (e) => { const startTime = performance.now(); requestAnimationFrame(() => { const interactionTime = performance.now() - startTime; this.performanceMetrics.interactionTime = Math.max( this.performanceMetrics.interactionTime, interactionTime ); }); }); // Periodic memory monitoring during monitoring sessions setInterval(() => { if (this.isMonitoring && performance.memory) { this.performanceMetrics.memoryUsage.push({ timestamp: Date.now(), used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024), total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) }); // Keep only last 20 measurements if (this.performanceMetrics.memoryUsage.length > 20) { this.performanceMetrics.memoryUsage.shift(); } } }, 30000); // Every 30 seconds } displayPerformanceMetrics() { // Create performance display for debugging const perfDiv = document.createElement('div'); perfDiv.id = 'performance-metrics'; perfDiv.style.cssText = ` position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; font-family: monospace; font-size: 12px; border-radius: 5px; z-index: 9999; `; const updatePerfDisplay = () => { const currentMemory = this.performanceMetrics.memoryUsage.slice(-1)[0]; perfDiv.innerHTML = ` <div><strong>Performance Metrics</strong></div> <div>Load Time: ${this.performanceMetrics.loadTime}ms</div> <div>Max Interaction: ${Math.round(this.performanceMetrics.interactionTime)}ms</div> ${currentMemory ? `<div>Memory: ${currentMemory.used}MB / ${currentMemory.total}MB</div>` : ''} <div>DOM Elements: ${document.querySelectorAll('*').length}</div> <div>Device APIs: ${Object.values(this.deviceSupport).filter(Boolean).length}/5</div> `; }; updatePerfDisplay(); document.body.appendChild(perfDiv); // Update every 5 seconds setInterval(updatePerfDisplay, 5000); } handleVisibilityChange() { if (document.hidden) { // Page is hidden, reduce resource usage console.log('Page hidden - reducing resource usage'); // Pause camera monitoring if active if (this.mediaStream) { this.mediaStream.getTracks().forEach(track => track.enabled = false); } } else { // Page is visible again, resume normal operation console.log('Page visible - resuming normal operation'); // Resume camera monitoring if it was active if (this.mediaStream) { this.mediaStream.getTracks().forEach(track => track.enabled = true); } } } handleDeviceMotion(event) { // Use device motion for activity detection (simplified) if (!this.isMonitoring) return; const acceleration = event.accelerationIncludingGravity; const totalAcceleration = Math.sqrt( acceleration.x * acceleration.x + acceleration.y * acceleration.y + acceleration.z * acceleration.z ); // Simple activity detection based on motion if (totalAcceleration > 12) { // High activity detected if (!document.getElementById('activityLevel')) { const activityDiv = document.createElement('div'); activityDiv.id = 'activityLevel'; document.querySelector('.health-metrics').appendChild(activityDiv); } document.getElementById('activityLevel').textContent = 'High Activity Detected'; } } startMonitoring() { if (this.isMonitoring) return; this.isMonitoring = true; startMonitoring() { if (this.isMonitoring) return; this.isMonitoring = true; this.sessionStartTime = Date.now(); this.dataPoints = 0; document.getElementById('startMonitoring').disabled = true; document.getElementById('stopMonitoring').disabled = false; document.getElementById('status').textContent = 'Active Monitoring'; document.getElementById('status').className = 'status-active'; // Announce to screen readers this.announceToScreenReader('Health monitoring session started. Real-time data collection active.'); // Start real-time data simulation this.monitoringInterval = setInterval(() => { this.updateVitalSigns(); this.checkForAnomalies(); this.updateSessionInfo(); }, 2000); // Update every 2 seconds this.showToast('🟢 Health monitoring started'); console.log('Health monitoring started with accessibility features'); } stopMonitoring() { if (!this.isMonitoring) return; this.isMonitoring = false; const sessionDuration = (Date.now() - this.sessionStartTime) / 1000; clearInterval(this.monitoringInterval); document.getElementById('startMonitoring').disabled = false; document.getElementById('stopMonitoring').disabled = true; document.getElementById('status').textContent = 'Monitoring Stopped'; document.getElementById('status').className = 'status-inactive'; // Stop camera monitoring if active if (this.mediaStream) { this.mediaStream.getTracks().forEach(track => track.stop()); this.mediaStream = null; document.getElementById('cameraFeed').classList.add('hidden'); document.getElementById('cameraPlaceholder').classList.remove('hidden'); } // Save session data const sessionData = { duration: sessionDuration, dataPoints: this.dataPoints, timestamp: Date.now(), deviceAPIsUsed: Object.keys(this.connectedDevices).filter(key => this.connectedDevices[key] !== null) }; // Store in localStorage const sessions = JSON.parse(localStorage.getItem('healthSessions') || '[]'); sessions.push(sessionData); localStorage.setItem('healthSessions', JSON.stringify(sessions)); // Announce completion this.announceToScreenReader( `Health monitoring session completed. Duration: ${Math.round(sessionDuration)} seconds, ${this.dataPoints} data points collected.` ); this.showToast(`✅ Session completed: ${Math.round(sessionDuration)}s, ${this.dataPoints} data points`); console.log('Health monitoring session completed:', sessionData); } updateVitalSigns() { // Simulate realistic vital signs with some randomness const baseHeartRate = this.currentActivity ? this.getActivityHeartRate() : 72; const heartRate = this.addRealisticVariation(baseHeartRate, 5); const baseSpo2 = 98; const spo2 = this.addRealisticVariation(baseSpo2, 1); const systolic = this.addRealisticVariation(120, 8); const diastolic = this.addRealisticVariation(80, 5); const temperature = this.addRealisticVariation(98.6, 0.3); // Update display document.getElementById('heartRate').textContent = Math.round(heartRate); document.getElementById('spo2').textContent = Math.round(spo2); document.getElementById('bloodPressure').textContent = `${Math.round(systolic)}/${Math.round(diastolic)}`; document.getElementById('temperature').textContent = temperature.toFixed(1); // Update status this.updateVitalStatus('heartRate', heartRate); this.updateVitalStatus('spo2', spo2); this.updateVitalStatus('bloodPressure', { systolic, diastolic }); this.updateVitalStatus('temperature', temperature); // Store data point this.healthData.push({ timestamp: Date.now(), heartRate: Math.round(heartRate), spo2: Math.round(spo2), systolic: Math.round(systolic), diastolic: Math.round(diastolic), temperature: temperature.toFixed(1), activity: this.currentActivity }); this.dataPoints++; } addRealisticVariation(base, range) { return base + (Math.random() - 0.5) * 2 * range; } getActivityHeartRate() { const activityMultipliers = { walking: 1.2, running: 1.8, cycling: 1.6, yoga: 1.1 }; return 72 * (activityMultipliers[this.currentActivity] || 1); } updateVitalStatus(type, value) { let status, element; switch(type) { case 'heartRate': element = document.getElementById('heartRateStatus'); if (value >= 60 && value <= 100) { status = 'Normal'; } else if (value < 60) { status = 'Low'; } else { status = 'High'; } break; case 'spo2': element = document.getElementById('spo2Status'); if (value >= 97) { status = 'Excellent'; } else if (value >= 95) { status = 'Good'; } else { status = 'Low'; } break; case 'bloodPressure': element = document.getElementById('bpStatus'); if (value.systolic <= 120 && value.diastolic <= 80) { status = 'Optimal'; } else if (value.systolic <= 140 && value.diastolic <= 90) { status = 'Normal'; } else { status = 'High'; } break; case 'temperature': element = document.getElementById('tempStatus'); if (value >= 97.0 && value <= 99.5) { status = 'Normal'; } else if (value < 97.0) { status = 'Low'; } else { status = 'Fever'; } break; } if (element) { element.textContent = status; element.className = `text-xs ${status === 'Normal' || status === 'Optimal' || status === 'Excellent' || status === 'Good' ? 'text-green-600' : 'text-red-600'} mt-1`; } } checkForAnomalies() { const currentData = this.healthData[this.healthData.length - 1]; if (!currentData) return; let alerts = []; if (currentData.heartRate > 120 || currentData.heartRate < 50) { alerts.push(`Heart rate: ${currentData.heartRate} BPM`); } if (currentData.spo2 < 94) { alerts.push(`Low oxygen: ${currentData.spo2}%`); } if (parseFloat(currentData.temperature) > 101.0) { alerts.push(`High fever: ${currentData.temperature}°F`); } if (alerts.length > 0) { this.showEmergencyAlert(alerts.join(', ')); } } showEmergencyAlert(message) { document.getElementById('alertMessage').textContent = `Abnormal readings detected: ${message}`; document.getElementById('emergencyModal').classList.remove('hidden'); } dismissEmergencyAlert() { document.getElementById('emergencyModal').classList.add('hidden'); } callEmergencyServices() { this.showToast('🚨 Emergency services contacted. Help is on the way.'); this.dismissEmergencyAlert(); // In a real app, this would contact actual emergency services } updateSessionInfo() { if (!this.sessionStartTime) return; const duration = Date.now() - this.sessionStartTime; const minutes = Math.floor(duration / 60000); const seconds = Math.floor((duration % 60000) / 1000); document.getElementById('sessionDuration').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; document.getElementById('dataPoints').textContent = this.dataPoints; } selectActivity(activity) { this.currentActivity = activity; document.getElementById('activityName').textContent = activity.charAt(0).toUpperCase() + activity.slice(1); document.getElementById('startActivity').disabled = false; // Update button styles document.querySelectorAll('.activity-btn').forEach(btn => { btn.classList.remove('ring-2', 'ring-blue-500'); }); document.querySelector(`[data-activity="${activity}"]`).classList.add('ring-2', 'ring-blue-500'); this.showToast(`🏃‍♂️ Selected activity: ${activity}`); } startActivity() { if (!this.currentActivity) return; this.activityStartTime = Date.now(); document.getElementById('startActivity').disabled = true; document.getElementById('stopActivity').disabled = false; // Start activity tracking this.activityInterval = setInterval(() => { this.updateActivityStats(); }, 1000); this.showToast(`🟢 Started ${this.currentActivity} activity`); } stopActivity() { clearInterval(this.activityInterval); document.getElementById('startActivity').disabled = false; document.getElementById('stopActivity').disabled = true; this.showToast(`🔴 Stopped ${this.currentActivity} activity`); this.saveActivityToGoogleFit(); } updateActivityStats() { if (!this.activityStartTime) return; const duration = Date.now() - this.activityStartTime; const minutes = Math.floor(duration / 60000); const seconds = Math.floor((duration % 60000) / 1000); // Calculate estimated calories and distance based on activity const activityData = { walking: { caloriesPerMin: 5, kmPerMin: 0.083 }, running: { caloriesPerMin: 12, kmPerMin: 0.167 }, cycling: { caloriesPerMin: 8, kmPerMin: 0.25 }, yoga: { caloriesPerMin: 3, kmPerMin: 0 } }; const data = activityData[this.currentActivity] || activityData.walking; const totalMinutes = duration / 60000; document.getElementById('duration').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; document.getElementById('calories').textContent = Math.round(totalMinutes * data.caloriesPerMin); document.getElementById('distance').textContent = (totalMinutes * data.kmPerMin).toFixed(1); } async syncWithGoogleFit() { this.showToast('🔄 Syncing with Google Fit...'); try { // Simulate API call to Google Fit await new Promise(resolve => setTimeout(resolve, 2000)); // In a real implementation, you would use the Google Fit API console.log('Syncing health data with Google API:', this.googleApiKey); console.log('Health data to sync:', this.healthData.slice(-10)); this.showToast('✅ Successfully synced with Google Fit'); } catch (error) { console.error('Sync failed:', error); this.showToast('❌ Sync failed. Please try again.'); } } async getAiHealthAnalysis() { this.showToast('🤖 Analyzing your health data...'); try { // Simulate AI analysis using the Google API await new Promise(resolve => setTimeout(resolve, 3000)); const analysis = this.generateHealthInsights(); this.displayAiInsights(analysis); this.showToast('✅ AI analysis complete'); } catch (error) { console.error('AI analysis failed:', error); this.showToast('❌ Analysis failed. Please try again.'); } } generateHealthInsights() { const recentData = this.healthData.slice(-10); if (recentData.length === 0) { return { status: 'No recent data available for analysis', recommendations: ['Start monitoring to get personalized insights'] }; } const avgHeartRate = recentData.reduce((sum, d) => sum + d.heartRate, 0) / recentData.length; const avgSpo2 = recentData.reduce((sum, d) => sum + d.spo2, 0) / recentData.length; let status = '✅ Your vital signs are within healthy ranges.'; let recommendations = [ '• Continue your current fitness routine', '• Maintain regular hydration', '• Ensure 7-9 hours of quality sleep' ]; if (avgHeartRate > 90) { status = '⚠️ Your heart rate is slightly elevated.'; recommendations = [ '• Consider stress management techniques', '• Ensure adequate rest between activities', '• Consult healthcare provider if persistent' ]; } if (avgSpo2 < 96) { status = '⚠️ Your oxygen levels could be improved.'; recommendations = [ '• Practice deep breathing exercises', '• Ensure good ventilation in your space', '• Consider cardiovascular exercise' ]; } return { status, recommendations }; } displayAiInsights(analysis) { const insightsContainer = document.getElementById('aiInsights'); insightsContainer.innerHTML = ` <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"> <h3 class="font-medium text-blue-800 dark:text-blue-300 mb-2">🤖 AI Health Analysis</h3> <p class="text-sm text-blue-700 dark:text-blue-400 mb-3">${analysis.status}</p> <div class="text-sm text-blue-700 dark:text-blue-400"> <strong>Personalized Recommendations:</strong> <ul class="mt-2 space-y-1"> ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')} </ul> </div> </div> `; } async saveActivityToGoogleFit() { if (!this.activityStartTime || !this.currentActivity) return; const activityData = { activity: this.currentActivity, startTime: this.activityStartTime, endTime: Date.now(), calories: parseInt(document.getElementById('calories').textContent), distance: parseFloat(document.getElementById('distance').textContent) }; console.log('Saving activity to Google Fit:', activityData); // In a real app, this would use the Google Fit API } updateDisplay() { // Initial display setup this.updateSessionInfo(); } showToast(message) { const toast = document.createElement('div'); toast.className = 'fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50'; toast.textContent = message; document.body.appendChild(toast); setTimeout(() => { toast.remove(); }, 3000); }
}

// Initialize Fitness Tracker when page loads
document.addEventListener('DOMContentLoaded', () => { new FitnessTracker();
});
</script>

{% endblock %}